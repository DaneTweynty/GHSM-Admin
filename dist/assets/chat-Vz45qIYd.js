import{r as e,V as t,P as s,S as a,a as r,C as n,b as d,c as l,I as i,X as o,d as c,e as u,D as m,R as h,f as x,M as p,g,h as f,i as v,j as b,k as w,l as j}from"./ui-CcSG_NNb.js";import{r as k}from"./vendor-DEQ385Nk.js";import{g as y}from"./calendar-CdK-zQpj.js";var N,S,I={exports:{}},C={};var M=(S||(S=1,I.exports=function(){if(N)return C;N=1;var e=k(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function d(e,s,d){var l,i={},o=null,c=null;for(l in void 0!==d&&(o=""+d),void 0!==s.key&&(o=""+s.key),void 0!==s.ref&&(c=s.ref),s)a.call(s,l)&&!n.hasOwnProperty(l)&&(i[l]=s[l]);if(e&&e.defaultProps)for(l in s=e.defaultProps)void 0===i[l]&&(i[l]=s[l]);return{$$typeof:t,type:e,key:o,ref:c,props:i,_owner:r.current}}return C.Fragment=s,C.jsx=d,C.jsxs=d,C}()),I.exports);const D=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A=["January","February","March","April","May","June","July","August","September","October","November","December"],T=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],E="12:00",B=8,O=4,R=["Piano","Guitar","Violin","Drums","Voice","Ukulele","Bass Guitar"],F=["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#CBAACB","#E2CFC4","#BDBDBD"],z={calendar:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),users:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a4 4 0 110-5.292M15 11a4 4 0 010 5.292"})}),billing:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),enrollment:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),teachers:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v11.494m-5.45-6.864l5.45 3.424 5.45-3.424M1.5 10.454l10.5 6.575 10.5-6.575M21 21l-9-5.25L3 21"})}),chat:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),check:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:M.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),paid:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-status-green mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:M.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),unpaid:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-status-yellow mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:M.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 102 0V6zm-1 9a1 1 0 110-2 1 1 0 010 2z",clipRule:"evenodd"})}),edit:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[M.jsx("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),M.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",clipRule:"evenodd"})]}),trash:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),settings:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),install:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),info:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:M.jsx("path",{fillRule:"evenodd",d:"M18 10A8 8 0 11 2 10a8 8 0 0116 0zm-8-3a1 1 0 100-2 1 1 0 000 2zm-1 2a1 1 0 000 2v3a1 1 0 102 0v-3a1 1 0 100-2h-1z",clipRule:"evenodd"})}),payCash:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[M.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),M.jsx("path",{d:"M7 12h.01M12 12h5"})]}),payBank:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[M.jsx("path",{d:"M3 10l9-6 9 6"}),M.jsx("path",{d:"M9 22V12h6v10"}),M.jsx("path",{d:"M21 22H3"})]}),payGCash:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[M.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"2"}),M.jsx("path",{d:"M11 18h2"})]}),payCredit:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[M.jsx("circle",{cx:"12",cy:"12",r:"9"}),M.jsx("path",{d:"M12 7v10M8 10h6a3 3 0 010 6H9"})]}),payOther:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:[M.jsx("circle",{cx:"5",cy:"12",r:"2"}),M.jsx("circle",{cx:"12",cy:"12",r:"2"}),M.jsx("circle",{cx:"19",cy:"12",r:"2"})]}),payMixed:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[M.jsx("rect",{x:"3",y:"7",width:"13",height:"10",rx:"2"}),M.jsx("path",{d:"M8 7V5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"})]})},P=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,W="admin",V=e=>{const[t,s]=e.split(":").map(Number);return 60*t+s},U=e=>{const t=Math.floor(e/60),s=e%60;return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},_=(e,t)=>U(V(e)+t),H=e=>{const t=V(e),s=15*Math.round(t/15);return U(s)},Y=(e,t,s,a)=>{const r=V(e),n=V(t),d=V(s);return r<V(a)&&n>d},q=e=>{const[t,s]=e.split(":");let a=parseInt(t,10);const r=parseInt(s,10),n=a>=12?"PM":"AM";return a%=12,0===a&&(a=12),`${a}:${String(r).padStart(2,"0")} ${n}`},G=e.createContext(void 0),J=({children:s})=>{const[a,r]=e.useState(()=>{const e=localStorage.getItem("app:view");return"dashboard"===e||"enrollment"===e||"teachers"===e||"students"===e||"billing"===e||"trash"===e?e:"dashboard"}),[n,d]=e.useState(!0),[l,i]=e.useState(null),[o,c]=e.useState([]),[u,m]=e.useState([]),[h,x]=e.useState([]),[p,g]=e.useState([]),[f,v]=e.useState(!1),[b,w]=e.useState(null),[j,k]=e.useState(!1),[N,S]=e.useState(()=>{const e=localStorage.getItem("app:currentDate"),t=e?new Date(e):new Date;return isNaN(t.getTime())?new Date:t}),[I,C]=e.useState(()=>{const e=localStorage.getItem("app:calendarView");return"day"===e||"week"===e||"month"===e||"year"===e?e:"month"}),[D,L]=e.useState(!1),[$,A]=e.useState(null),[B,O]=e.useState(!1),[R,z]=e.useState(null),[W,U]=e.useState(!1),[q,J]=e.useState(!1),[K,Z]=e.useState(null),[Q,X]=e.useState(null),[ee,te]=e.useState(null),[se,ae]=e.useState(()=>{const e=localStorage.getItem("theme");return"light"===e||"dark"===e||"comfort"===e||"system"===e?e:"comfort"}),[re,ne]=e.useState(()=>{const e=localStorage.getItem("fontSize");return"sm"===e||"base"===e||"lg"===e?e:"base"}),[de,le]=e.useState(!1),[ie,oe]=e.useState(null),[ce,ue]=e.useState(()=>{try{const e=localStorage.getItem("app:transactions");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}),me=e.useCallback((e,s,a,r)=>{const n={id:`tx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,type:e,status:s,message:a,timestamp:Date.now(),meta:r};ue(e=>{const t=[n,...e].slice(0,100);try{localStorage.setItem("app:transactions",JSON.stringify(t))}catch(s){}return t}),"success"===s?t.success(a):"error"===s?t.error(a):t(a)},[]);e.useEffect(()=>{const e=e=>{e.preventDefault(),oe(e)};return window.addEventListener("beforeinstallprompt",e),()=>window.removeEventListener("beforeinstallprompt",e)},[]);e.useEffect(()=>{localStorage.setItem("app:view",a)},[a]),e.useEffect(()=>{localStorage.setItem("app:calendarView",I)},[I]),e.useEffect(()=>{try{localStorage.setItem("app:currentDate",N.toISOString())}catch(e){}},[N]),e.useEffect(()=>{const e=document.documentElement,t=()=>{const t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;("system"===se?t:"dark"===se)?e.classList.add("dark"):e.classList.remove("dark"),"comfort"===se||"system"===se&&!t?e.classList.add("comfort"):e.classList.remove("comfort")};t();try{localStorage.setItem("theme",se)}catch(a){}let s=null;if("system"===se&&window.matchMedia){s=window.matchMedia("(prefers-color-scheme: dark)");const e=()=>t();return s.addEventListener?s.addEventListener("change",e):s.addListener(e),()=>{s&&(s.removeEventListener?s.removeEventListener("change",e):s.removeListener(e))}}return()=>{}},[se]),e.useEffect(()=>{document.documentElement.style.fontSize="sm"===re?"87.5%":"lg"===re?"112.5%":"100%",localStorage.setItem("fontSize",re)},[re]);const he=e.useCallback(()=>{const e=o.reduce((e,t)=>{const s=parseInt(t.studentIdNumber,10);return!isNaN(s)&&s>e?s:e},0);return(e>0?e+1:100001).toString()},[o]),xe=e.useCallback(async()=>{d(!0),i(null);try{const e=await fetch("/initial-data.json");if(!e.ok)throw new Error(`Failed to load data: ${e.statusText}`);const{students:t,instructors:s}=await e.json(),a=t.map((e,t)=>({...e,id:`student-${t+1}`,sessionsAttended:0,sessionsBilled:0,status:"active"})),r=s.map((e,t)=>({...e,id:`inst-${t+1}`,color:F[t%F.length],status:"active"})),{lessons:n,students:d}=y(a,r);c(d),m(r),x(n),g([])}catch(e){i("Failed to initialize application data. Please try refreshing the page."),me("app.init","error","Failed to initialize application data")}finally{d(!1)}},[me]);e.useEffect(()=>{xe()},[xe]),e.useEffect(()=>{const e=[];o.forEach(t=>{const s=p.filter(e=>e.studentId===t.id).reduce((e,t)=>Math.max(e,t.sessionsCovered),0);let a=t.sessionsAttended-s,r=s;for(;a>=4;)r+=4,e.push({id:`bill-${Date.now()}-${t.id}-${r}`,studentId:t.id,studentName:t.name,amount:1900,status:"unpaid",sessionsCovered:r,dateIssued:(new Date).toISOString()}),a-=4}),e.length>0&&g(t=>[...t,...e])},[o,p]);const pe=e.useCallback(e=>{S(t=>{const s=new Date(t);return"year"===I?s.setFullYear(s.getFullYear()+("next"===e?1:-1)):"month"===I?s.setMonth(s.getMonth()+("next"===e?1:-1)):"week"===I?s.setDate(s.getDate()+("next"===e?7:-7)):s.setDate(s.getDate()+("next"===e?1:-1)),s})},[I]),ge=e.useCallback(e=>{S(e),C("month")},[]),fe=e.useCallback(e=>{let t=!1;c(s=>{const a=[...s],r=a.findIndex(t=>t.id===e);if(-1===r)return s;const n={...a[r]},d=Date.now();return n.lastAttendanceMarkedAt&&d-n.lastAttendanceMarkedAt<864e5?s:(n.sessionsAttended+=1,n.lastAttendanceMarkedAt=d,a[r]=n,t=!0,a)}),t?me("attendance.mark","success","Attendance marked"):me("attendance.mark","error","Attendance already marked in the last 24 hours")},[]),ve=e.useCallback((e,t)=>{g(s=>{const a=s.map(s=>{if(s.id!==e)return s;const a={id:`pay-${Date.now()}`,billingId:s.id,studentId:s.studentId,amount:Number(t.amount)||0,method:t.method,reference:t.reference,note:t.note,overpayHandling:t.overpayHandling,date:(new Date).toISOString()},r=[...s.payments||[],a],n=r.reduce((e,t)=>e+(Number(t.amount)||0),0),d=n>=s.amount?"paid":"unpaid";return{...s,payments:r,paidAmount:n,status:d}}),r=a.find(t=>t.id===e);if(r){const s=r.studentId,n=(r.paidAmount||0)-r.amount,d=t.overpayHandling??"next",l=4*a.filter(e=>e.studentId===s&&"paid"===e.status).length;c(e=>e.map(e=>{if(e.id!==s)return e;let a=e.creditBalance||0;if("Credit"===t.method){const e=Math.max(0,Math.min(a,Number(t.amount)||0));a=Math.max(0,a-e)}return n>0&&"next"===d&&(a+=n),{...e,creditBalance:a,sessionsBilled:l}}));const i=Number(t.amount||0);me("payment.record","success",`Payment recorded (${t.method}) - ${i.toLocaleString()}`,{billingId:e,amount:i})}return a})},[me]),be=e.useCallback((e,t)=>{g(s=>s.map(s=>{if(s.id!==e)return s;const a={...s,...t};if(t.items){const e=t.items.reduce((e,t)=>e+(Number(t.quantity)||0)*(Number(t.unitAmount)||0),0);a.items=t.items,a.amount=e}return a})),me("billing.update","success","Billing updated",{billingId:e})},[me]),we=e.useMemo(()=>u.filter(e=>"active"===e.status),[u]),je=e.useCallback(e=>{w(e),k(!1),v(!0)},[]),ke=e.useCallback((e,t)=>{const s=o.find(e=>"active"===e.status),a={id:`lesson-${Date.now()}`,studentId:(null==s?void 0:s.id)||"",instructorId:we.length>0?we[0].id:"",roomId:1,date:P(e),time:t||T[0],endTime:_(t||T[0],60),notes:"",status:"scheduled"};w(a),k(!0),v(!0)},[o,we]),ye=e.useCallback(()=>{w(null),v(!1),k(!1)},[]),Ne=e.useCallback(e=>{x(t=>t.map(t=>t.id===e?{...t,status:"deleted"}:t)),ye(),me("lesson.delete","success","Lesson moved to trash",{lessonId:e})},[ye,me]),Se=e.useCallback((e,t)=>{for(const s of h)if(s.id!==t&&"deleted"!==s.status&&s.date===e.date){const t=s.time,a=s.endTime||_(s.time,60),r=e.time,n=e.endTime||_(e.time,60);if(Y(t,a,r,n)){if(s.instructorId===e.instructorId){const e=u.find(e=>e.id===s.instructorId);return`Instructor ${(null==e?void 0:e.name)||""} is already scheduled during this time.`}if(s.roomId===e.roomId)return`Room ${s.roomId} is already booked during this time.`;if(s.studentId===e.studentId){const e=o.find(e=>e.id===s.studentId);return`Student ${(null==e?void 0:e.name)||""} already has a lesson during this time.`}}}return null},[h,u,o]),Ie=e.useCallback(e=>{if(j){const{repeatWeekly:s,repeatWeeks:a,...r}=e,n=o.find(e=>e.id===r.studentId);if(n&&"inactive"===n.status){const e="This student is not currently enrolled. Please activate the student to schedule new lessons.";return t.error(e),void me("lesson.create","error",e)}const d={...r,status:"scheduled"},l=[d];if(!!s&&(a??0)>0){const e=Math.min(52,Math.max(1,a||1)),t=new Date(`${r.date}T00:00:00`),s=V(r.endTime||_(r.time,60))-V(r.time);for(let a=1;a<=e;a++){const e=new Date(t);e.setDate(e.getDate()+7*a);const n=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,i={...d,id:`lesson-${Date.now()}-${a}`,date:n,time:r.time,endTime:_(r.time,s)},o=V(E),c=V(i.time),u=V(i.endTime||_(i.time,60));if(c<o&&o<u)continue;const{id:m,...h}=i;Se(h,void 0)||l.push(i)}}x(e=>[...e,...l]);const i=l.length-1;me("lesson.create","success","Lesson added"+(i>0?` (+${i} repeats)`:""))}else{const{repeatWeekly:t,repeatWeeks:s,...a}=e,r={...a,status:"scheduled"};x(e=>e.map(e=>e.id===r.id?r:e));const n=h.find(e=>e.id===r.id);if(n&&n.instructorId!==r.instructorId&&c(e=>e.map(e=>e.id===r.studentId?{...e,instructorId:r.instructorId}:e)),t&&(s??0)>0){const e=Math.min(52,Math.max(1,s||1)),t=new Date(`${r.date}T00:00:00`),a=V(r.endTime||_(r.time,60))-V(r.time),n=[];for(let s=1;s<=e;s++){const e=new Date(t);e.setDate(e.getDate()+7*s);const d=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,l={...r,id:`lesson-${Date.now()}-e${s}`,date:d,time:r.time,endTime:_(r.time,a)},i=V(E),o=V(l.time),c=V(l.endTime||_(l.time,60));if(o<i&&i<c)continue;const{id:u,...m}=l;Se(m,void 0)||n.push(l)}n.length&&x(e=>[...e,...n])}me("lesson.update","success","Lesson updated")}ye()},[h,j,ye,o,Se,me]),Ce=e.useCallback((e,s,a,r)=>{const n=h.find(t=>t.id===e);if(!n)return;const d=o.find(e=>e.id===n.studentId);if(d&&"inactive"===d.status)return t.error(`Cannot schedule lessons for ${d.name} because they are not enrolled.`),void me("lesson.move","error","Cannot move/copy: student is not enrolled",{lessonId:e});const l=P(s),i=a?H(a):n.time,c=n.endTime?(new Date(`1970-01-01T${n.endTime}:00Z`).getTime()-new Date(`1970-01-01T${n.time}:00Z`).getTime())/6e4:60,u=_(i,c),m=V(E),p=V(i),g=V(u);if(p<m&&m<g)return t.error(`Cannot schedule a lesson overlapping the lunch break (${E}).`),void me("lesson.move","error","Cannot move/copy: overlaps lunch break",{lessonId:e});const f={...n,date:l,time:i,endTime:u};if(r){const s={...f,id:`lesson-${Date.now()}`,notes:`(Copied) ${n.notes||""}`.trim(),status:"scheduled"},a=Se(s);if(a)return t.error(`Could not copy lesson: ${a}`),void me("lesson.copy","error",a,{lessonId:e});x(e=>[...e,s]),me("lesson.copy","success","Lesson copied",{lessonId:e,newLessonId:s.id})}else{const s={...f},a=Se(s,n.id);if(a)return t.error(`Could not move lesson: ${a}`),void me("lesson.move","error",a,{lessonId:e});x(t=>t.map(t=>t.id===e?s:t)),me("lesson.move","success","Lesson moved",{lessonId:e})}},[h,Se,o,me]),Me=e.useCallback(e=>{const t={id:`student-${Date.now()}`,studentIdNumber:he(),name:e.name,instrument:e.instrument,instructorId:e.instructorId,sessionsAttended:0,sessionsBilled:0,nickname:e.nickname,birthdate:e.birthdate,age:e.age,email:e.email,contactNumber:e.contactNumber,facebook:e.facebook,gender:e.gender,address:e.address,guardianFullName:e.guardianFullName,guardianPhone:e.guardianPhone,guardianEmail:e.guardianEmail,guardianFacebook:e.guardianFacebook,secondaryGuardian:e.secondaryGuardian,status:"active",profilePictureUrl:void 0,parentStudentId:e.parentStudentId};c(e=>[...e,t].sort((e,t)=>e.name.localeCompare(t.name)))},[he]),De=e.useCallback(e=>{c(t=>t.map(t=>t.id===e?{...t,status:"active"===t.status?"inactive":"active"}:t));const t=o.find(t=>t.id===e);t&&me("student.status","success","Student "+("active"===t.status?"deactivated":"activated"),{studentId:e})},[o,me]),Le=e.useCallback(e=>{A(e),L(!0)},[]),$e=e.useCallback(()=>{A(null),L(!1)},[]),Ae=e.useCallback((e,t)=>{c(s=>s.map(s=>s.id===e?{...s,sessionsAttended:s.sessionsBilled+t}:s)),$e(),me("student.status","success","Sessions updated",{studentId:e,unpaidCount:t})},[$e]),Te=e.useCallback((e,t)=>{c(s=>s.map(s=>s.id===e?{...s,...t}:s)),me("student.contact.update","success","Student contact updated",{studentId:e})},[me]),Ee=e.useCallback(e=>{z(e),O(!0)},[]),Be=e.useCallback(()=>{z(null),U(!0),O(!0)},[]),Oe=e.useCallback(()=>{z(null),O(!1),U(!1)},[]),Re=e.useCallback(e=>{if(W){const t={...e,id:`inst-${Date.now()}`,status:"active"};m(e=>[...e,t].sort((e,t)=>e.name.localeCompare(t.name))),me("instructor.save","success","Instructor added",{instructorId:t.id})}else m(t=>t.map(t=>t.id===e.id?e:t)),me("instructor.save","success","Instructor updated",{instructorId:e.id});Oe()},[W,Oe,me]),Fe=e.useCallback(e=>{Z(e),J(!0)},[]),ze=e.useCallback(async()=>{if(J(!1),K){switch(K.type){case"addInstructor":Be();break;case"toggleInstructorStatus":{const{instructorId:e}=K;m(t=>t.map(t=>t.id===e?{...t,status:"active"===t.status?"inactive":"active"}:t));const t=u.find(t=>t.id===e);t&&me("instructor.status","success","Instructor "+("active"===t.status?"deactivated":"activated"),{instructorId:e});break}case"deleteLessonPermanently":x(e=>e.filter(e=>e.id!==K.lessonId)),me("lesson.delete","success","Lesson permanently deleted",{lessonId:K.lessonId});break;case"enrollStudent":{const{studentData:e}=K;Me(e),X(`Student "${e.name.trim()}" has been successfully enrolled!`),setTimeout(()=>X(null),5e3),me("student.enroll","success",`Enrolled ${e.name} in ${e.instrument}`);break}case"resetData":await xe(),me("app.reset","success","Application data reset")}Z(null)}},[K,Be,Me,xe,u,me]),Pe=e.useCallback(()=>{J(!1)},[]),We=e.useCallback(e=>{Fe({type:"toggleInstructorStatus",instructorId:e})},[Fe]),Ve=e.useCallback(e=>{Fe({type:"enrollStudent",studentData:e})},[Fe]),Ue=e.useCallback(()=>{Fe({type:"resetData"})},[Fe]),_e=e.useCallback(e=>{const s=h.find(t=>t.id===e);if(!s)return;const a=Se(s,e);if(a)return t.error(`Could not restore lesson: ${a}`),void me("lesson.restore","error",a,{lessonId:e});x(t=>t.map(t=>t.id===e?{...t,status:"scheduled"}:t)),me("lesson.restore","success","Lesson restored",{lessonId:e})},[h,me]),He=e.useMemo(()=>h.filter(e=>"scheduled"===e.status),[h]),Ye=e.useMemo(()=>h.filter(e=>"deleted"===e.status),[h]),qe=()=>le(!1),Ge={view:a,setView:r,isLoading:n,error:l,students:o,instructors:u,lessons:h,billings:p,currentDate:N,setCurrentDate:S,calendarView:I,setCalendarView:C,theme:se,fontSize:re,handleThemeToggle:()=>ae(e=>"light"===e?"dark":"dark"===e?"comfort":"comfort"===e?"system":"light"),setThemeMode:e=>ae(e),handleFontSizeChange:e=>ne(e),activeLessons:He,deletedLessons:Ye,activeInstructors:we,initializeAppData:xe,handleNavigate:pe,handleDateSelect:ge,handleOpenEditModal:je,handleOpenAddModal:ke,handleCloseEditModal:ye,isEditModalOpen:f,editingLesson:b,isAddMode:j,handleUpdateLesson:Ie,handleMoveLessonToTrash:Ne,handleUpdateLessonPosition:Ce,handleLessonDragStart:(e,t)=>{e.dataTransfer.setData("lessonId",t.id),e.dataTransfer.effectAllowed=e.altKey?"copy":"move",le(!0)},handleLessonDragEnd:qe,handleMarkAttendance:fe,handleRecordPayment:ve,handleToggleStudentStatus:De,isEditSessionModalOpen:D,editingStudent:$,handleOpenEditSessionModal:Le,handleCloseEditSessionModal:$e,handleUpdateStudentSessions:Ae,isEditInstructorModalOpen:B,editingInstructor:R,isAddInstructorMode:W,handleOpenEditInstructorModal:Ee,handleOpenAddInstructorModal:Be,handleCloseEditInstructorModal:Oe,handleSaveInstructor:Re,isAdminAuthModalOpen:q,adminActionToConfirm:K,getAdminActionDescription:()=>{if(!K)return"";switch(K.type){case"addInstructor":return"add a new instructor";case"toggleInstructorStatus":{const e=u.find(e=>e.id===K.instructorId);if(!e)return"";return`${"active"===e.status?"deactivate":"activate"} instructor "${e.name||""}"`}case"deleteLessonPermanently":{const e=h.find(e=>e.id===K.lessonId);if(!e)return"";const t=o.find(t=>t.id===e.studentId);return`permanently delete lesson for ${(null==t?void 0:t.name)||"Unknown"} on ${e.date}`}case"enrollStudent":return`enroll new student "${K.studentData.name}"`;case"resetData":return"reset all application data to its default state. This action is irreversible"}},handleRequestAdminAction:Fe,handleAdminAuthSuccess:ze,handleCloseAdminAuthModal:Pe,handleToggleInstructorStatus:We,handleRequestEnrollment:Ve,handleRequestResetData:Ue,handleRestoreLesson:_e,handleUpdateBilling:be,handleUpdateStudentContact:Te,enrollmentSuccessMessage:Q,installPromptEvent:ie,handleInstallRequest:()=>{ie&&(ie.prompt(),ie.userChoice.then(()=>oe(null)))},isDragging:de,handleDropOnTrash:e=>{Ne(e),le(!1)},timeSlots:T,transactions:ce};return M.jsx(G.Provider,{value:Ge,children:M.jsx("div",{onDragEnd:qe,children:s})})},K=()=>{const t=e.useContext(G);if(!t)throw new Error("useApp must be used within AppProvider");return t},Z=[{emoji:"ðŸ‘",text:"ðŸ‘"},{emoji:"â¤ï¸",text:"â¤ï¸"},{emoji:"ðŸ˜‚",text:"ðŸ˜‚"},{emoji:"ðŸ˜¢",text:"ðŸ˜¢"},{emoji:"ðŸŽ‰",text:"ðŸŽ‰"},{emoji:"ðŸ’¯",text:"ðŸ’¯"}],Q=({instructors:t,currentUser:k})=>{var y,N,S,I;const[C,D]=e.useState([]),[L,$]=e.useState({}),[A,T]=e.useState(null),[E,B]=e.useState(""),[O,R]=e.useState(""),[F]=e.useState({}),[z,P]=e.useState(null),[W,V]=e.useState(!1),[U,_]=e.useState(0),[H,Y]=e.useState(!1),[q,G]=e.useState(null),[J,K]=e.useState({}),Q=e.useRef(null),X=e.useRef(null),ee=e.useRef(null),te=e.useRef(null),se=e.useRef(null);e.useEffect(()=>{var e;null==(e=X.current)||e.scrollIntoView({behavior:"smooth"})},[L,A]),e.useEffect(()=>{const e=t.map(e=>({id:`conv-${e.id}`,participants:[{id:e.id,name:e.name,type:"instructor",isOnline:Math.random()>.5,lastSeen:(new Date).toISOString()},{id:k.id,name:k.name,type:k.type,isOnline:!0}],unreadCount:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isTyping:[]}));D(e)},[t,k]);const ae=C.find(e=>e.id===A),re=A&&L[A]||[],ne=z?re.find(e=>e.id===z):null,de=(e,t)=>{if(!A)return;const s={id:`msg-${Date.now()}`,senderId:k.id,senderName:k.name,senderType:k.type,content:"",timestamp:(new Date).toISOString(),readBy:[k.id],type:"voice",status:"sent",voiceData:{duration:t,url:e}};$(e=>({...e,[A]:[...e[A]||[],s]}))},le=e.useCallback(e=>{A&&0!==e.length&&Array.from(e).forEach(e=>{const t={id:`msg-${Date.now()}-${Math.random()}`,senderId:k.id,senderName:k.name,senderType:k.type,content:e.name,timestamp:(new Date).toISOString(),readBy:[k.id],type:e.type.startsWith("image/")?"image":"file",status:"sent",fileData:{name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)}};$(e=>({...e,[A]:[...e[A]||[],t]}))})},[A,k]),ie=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),H||Y(!0)},[H]),oe=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&Y(!1)},[]),ce=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),Y(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&le(e.dataTransfer.files)},[le]),ue=(e,t)=>{A&&$(s=>{var a;return{...s,[A]:(null==(a=s[A])?void 0:a.map(s=>{if(s.id===e){const e=s.reactions||[];return e.find(e=>e.userId===k.id&&e.emoji===t)?{...s,reactions:e.filter(e=>!(e.userId===k.id&&e.emoji===t))}:{...s,reactions:[...e,{userId:k.id,userName:k.name,emoji:t,timestamp:(new Date).toISOString()}]}}return s}))||[]}})},me=()=>{if(!E.trim()||!A)return;const e={id:`msg-${Date.now()}`,senderId:k.id,senderName:k.name,senderType:k.type,content:E,timestamp:(new Date).toISOString(),readBy:[k.id],type:"text",status:"sent",...z&&{replyTo:z}};$(t=>({...t,[A]:[...t[A]||[],e]})),B(""),P(null)},he=e=>{switch(e){case"sending":return M.jsx(j,{className:"w-3 h-3 text-text-tertiary dark:text-slate-500"});case"sent":return M.jsx(w,{className:"w-3 h-3 text-text-tertiary dark:text-slate-500"});case"delivered":return M.jsx(b,{className:"w-3 h-3 text-text-tertiary dark:text-slate-500"});case"read":return M.jsx(b,{className:"w-3 h-3 text-brand-primary"});default:return null}};return M.jsxs("div",{className:"flex h-full w-full bg-surface-main dark:bg-slate-900 transition-colors duration-200",onDragOver:ie,onDragLeave:oe,onDrop:ce,children:[H&&M.jsx("div",{className:"absolute inset-0 bg-brand-primary/20 border-2 border-dashed border-brand-primary flex items-center justify-center z-50",children:M.jsxs("div",{className:"text-center",children:[M.jsx(s,{className:"w-12 h-12 mb-4 mx-auto text-brand-primary"}),M.jsx("div",{className:"text-lg font-semibold text-brand-primary",children:"Drop files here to share"})]})}),M.jsxs("div",{className:"w-80 border-r border-surface-border dark:border-slate-700 bg-surface-card dark:bg-slate-800 flex flex-col h-full",children:[M.jsxs("div",{className:"p-4 border-b border-surface-border dark:border-slate-700 flex-shrink-0",children:[M.jsxs("div",{className:"flex items-center justify-between mb-4",children:[M.jsx("h2",{className:"text-lg font-semibold text-text-primary dark:text-slate-200",children:"Messages"}),M.jsx("div",{className:"flex items-center space-x-2",children:M.jsx("button",{className:"p-2 rounded-lg transition-colors hover:bg-surface-hover dark:hover:bg-slate-700",title:"Settings",children:M.jsx(a,{className:"w-4 h-4 text-text-secondary dark:text-slate-400"})})})]}),M.jsxs("div",{className:"relative",children:[M.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-tertiary dark:text-slate-500"}),M.jsx("input",{type:"text",placeholder:"Search conversations...",value:O,onChange:e=>{return t=e.target.value,R(t),void(t.trim()&&Object.values(L).flat().filter(e=>e.content.toLowerCase().includes(t.toLowerCase())||e.senderName.toLowerCase().includes(t.toLowerCase())));var t},className:"w-full pl-10 pr-4 py-2 rounded-lg border border-surface-border dark:border-slate-600 bg-surface-input dark:bg-slate-700 text-text-primary dark:text-slate-200 placeholder-text-tertiary dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-brand-primary"})]})]}),M.jsx("div",{className:"flex-1 overflow-y-auto",children:C.map(e=>{var t;const s=e.participants.find(e=>e.id!==k.id),a=null==(t=L[e.id])?void 0:t.slice(-1)[0];return M.jsx("div",{onClick:()=>T(e.id),className:"p-4 cursor-pointer border-b border-surface-border dark:border-slate-700 transition-colors hover:bg-surface-hover dark:hover:bg-slate-700 "+(A===e.id?"bg-brand-primary-light dark:bg-slate-600":""),children:M.jsxs("div",{className:"flex items-center space-x-3",children:[M.jsxs("div",{className:"relative",children:[M.jsx("div",{className:"w-10 h-10 bg-brand-primary rounded-full flex items-center justify-center",children:M.jsx("span",{className:"text-white font-semibold",children:(null==s?void 0:s.name.charAt(0))||"?"})}),(null==s?void 0:s.isOnline)&&M.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-status-green border-2 border-surface-card dark:border-slate-800 rounded-full"})]}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("h3",{className:"font-medium text-text-primary dark:text-slate-200 truncate",children:(null==s?void 0:s.name)||"Unknown"}),a&&M.jsx("span",{className:"text-xs text-text-tertiary dark:text-slate-500",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("p",{className:"text-sm text-text-secondary dark:text-slate-400 truncate",children:a?"voice"===a.type?"ðŸŽµ Voice message":"image"===a.type?"ðŸ“· Image":"file"===a.type?"ðŸ“Ž File":a.content:"No messages yet"}),e.unreadCount>0&&M.jsx("div",{className:"bg-brand-primary text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:e.unreadCount})]}),F[e.id]&&F[e.id].length>0&&M.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[M.jsxs("div",{className:"flex space-x-1",children:[M.jsx(n,{className:"w-2 h-2 text-brand-primary animate-bounce"}),M.jsx(n,{className:"w-2 h-2 text-brand-primary animate-bounce delay-100"}),M.jsx(n,{className:"w-2 h-2 text-brand-primary animate-bounce delay-200"})]}),M.jsx("span",{className:"text-xs text-text-tertiary dark:text-slate-500",children:"typing..."})]})]})]})},e.id)})})]}),M.jsx("div",{className:"flex-1 flex flex-col h-full bg-surface-main dark:bg-slate-900",children:ae?M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"p-4 border-b border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-3",children:[M.jsxs("div",{className:"relative",children:[M.jsx("div",{className:"w-8 h-8 bg-brand-primary rounded-full flex items-center justify-center",children:M.jsx("span",{className:"text-white text-sm font-semibold",children:(null==(y=ae.participants.find(e=>e.id!==k.id))?void 0:y.name.charAt(0))||"?"})}),(null==(N=ae.participants.find(e=>e.id!==k.id))?void 0:N.isOnline)&&M.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-status-green border-2 border-surface-header dark:border-slate-800 rounded-full"})]}),M.jsxs("div",{children:[M.jsx("h3",{className:"font-semibold text-text-primary dark:text-slate-200",children:(null==(S=ae.participants.find(e=>e.id!==k.id))?void 0:S.name)||"Unknown"}),M.jsx("p",{className:"text-xs text-text-secondary dark:text-slate-400",children:(null==(I=ae.participants.find(e=>e.id!==k.id))?void 0:I.isOnline)?"Online":"Offline"})]})]}),M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx("button",{className:"p-2 rounded-lg transition-colors hover:bg-surface-hover dark:hover:bg-slate-700",children:M.jsx(d,{className:"w-4 h-4 text-text-secondary dark:text-slate-400"})}),M.jsx("button",{className:"p-2 rounded-lg transition-colors hover:bg-surface-hover dark:hover:bg-slate-700",children:M.jsx(l,{className:"w-4 h-4 text-text-secondary dark:text-slate-400"})}),M.jsx("button",{className:"p-2 rounded-lg transition-colors hover:bg-surface-hover dark:hover:bg-slate-700",children:M.jsx(i,{className:"w-4 h-4 text-text-secondary dark:text-slate-400"})})]})]}),ne&&M.jsx("div",{className:"p-3 border-b border-surface-border dark:border-slate-700 bg-surface-card dark:bg-slate-800",children:M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-3",children:[M.jsx("div",{className:"w-1 h-8 bg-brand-primary rounded-full"}),M.jsxs("div",{children:[M.jsxs("p",{className:"text-sm font-medium text-text-primary dark:text-slate-200",children:["Replying to ",ne.senderName]}),M.jsx("p",{className:"text-xs text-text-secondary dark:text-slate-400 truncate max-w-xs",children:ne.content})]})]}),M.jsx("button",{onClick:()=>P(null),className:"p-1 hover:bg-surface-hover dark:hover:bg-slate-700 rounded",children:M.jsx(o,{className:"w-4 h-4 text-text-secondary dark:text-slate-400"})})]})}),M.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[re.map(e=>{var t,a;return M.jsx("div",{className:`flex ${e.senderId===k.id?"justify-end":"justify-start"} group`,children:M.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg relative "+(e.senderId===k.id?"bg-brand-primary text-text-on-color ml-auto":"bg-surface-card dark:bg-slate-700 text-text-primary dark:text-slate-200"),children:[e.replyTo&&M.jsx("div",{className:"mb-2 p-2 border-l-2 border-brand-secondary bg-brand-primary-light dark:bg-slate-600 rounded",children:M.jsx("p",{className:"text-xs text-text-secondary dark:text-slate-300",children:(null==(t=re.find(t=>t.id===e.replyTo))?void 0:t.content)||"Original message"})}),M.jsx("div",{className:"space-y-2",children:"voice"===e.type&&e.voiceData?M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx("button",{onClick:()=>{const t=new Audio(e.voiceData.url);J[e.id]?(t.pause(),K(t=>({...t,[e.id]:!1}))):(t.play(),K(t=>({...t,[e.id]:!0})),t.onended=()=>K(t=>({...t,[e.id]:!1})))},className:"p-2 rounded-full bg-surface-hover dark:bg-slate-600",children:J[e.id]?M.jsx(c,{className:"w-4 h-4"}):M.jsx(u,{className:"w-4 h-4"})}),M.jsx("div",{className:"flex-1",children:M.jsx("div",{className:"w-20 h-1 bg-surface-border dark:bg-slate-600 rounded-full",children:M.jsx("div",{className:"w-4 h-1 bg-brand-primary rounded-full"})})}),M.jsxs("span",{className:"text-xs",children:[Math.floor(e.voiceData.duration/60),":",(e.voiceData.duration%60).toString().padStart(2,"0")]})]}):"image"===e.type&&e.fileData?M.jsxs("div",{className:"space-y-2",children:[M.jsx("img",{src:e.fileData.url,alt:e.fileData.name,className:"max-w-full h-auto rounded"}),M.jsx("p",{className:"text-sm",children:e.content})]}):"file"===e.type&&e.fileData?M.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-surface-input dark:bg-slate-600 rounded",children:[M.jsx(s,{className:"w-4 h-4"}),M.jsx("span",{className:"text-sm flex-1",children:e.fileData.name}),M.jsx("button",{className:"p-1 hover:bg-surface-hover dark:hover:bg-slate-700 rounded",children:M.jsx(m,{className:"w-3 h-3"})})]}):M.jsx("p",{className:"text-sm",children:e.content})}),M.jsxs("div",{className:"flex items-center justify-between mt-2",children:[M.jsx("span",{className:"text-xs text-text-tertiary dark:text-slate-500",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),M.jsxs("div",{className:"flex items-center space-x-1",children:[M.jsx("div",{className:"flex space-x-1",children:null==(a=e.reactions)?void 0:a.map((t,s)=>M.jsx("button",{onClick:()=>ue(e.id,t.emoji),className:"text-xs px-1 py-0.5 bg-surface-hover dark:bg-slate-600 rounded",children:t.emoji},s))}),M.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[M.jsx("button",{onClick:()=>P(e.id),className:"p-1 hover:bg-surface-hover dark:hover:bg-slate-600 rounded",children:M.jsx(h,{className:"w-3 h-3"})}),M.jsx("button",{onClick:()=>G(q===e.id?null:e.id),className:"p-1 hover:bg-surface-hover dark:hover:bg-slate-600 rounded",children:M.jsx(x,{className:"w-3 h-3"})})]}),e.senderId===k.id&&M.jsx("div",{className:"flex items-center space-x-1",children:he(e.status||"sent")})]}),q===e.id&&M.jsx("div",{className:"absolute bottom-full right-0 mb-2 p-2 bg-surface-card dark:bg-slate-700 border border-surface-border dark:border-slate-600 rounded-lg shadow-lg z-10",children:M.jsx("div",{className:"flex space-x-1",children:Z.map(t=>M.jsx("button",{onClick:()=>{ue(e.id,t.emoji),G(null)},className:"p-1 hover:bg-surface-hover dark:hover:bg-slate-600 rounded",children:t.text},t.emoji))})})]})]})},e.id)}),A&&F[A]&&F[A].length>0&&M.jsx("div",{className:"flex justify-start",children:M.jsx("div",{className:"bg-surface-card dark:bg-slate-700 px-4 py-2 rounded-lg",children:M.jsxs("div",{className:"flex space-x-1",children:[M.jsx("div",{className:"w-2 h-2 bg-text-tertiary dark:bg-slate-400 rounded-full animate-bounce"}),M.jsx("div",{className:"w-2 h-2 bg-text-tertiary dark:bg-slate-400 rounded-full animate-bounce delay-100"}),M.jsx("div",{className:"w-2 h-2 bg-text-tertiary dark:bg-slate-400 rounded-full animate-bounce delay-200"})]})})}),M.jsx("div",{ref:X})]}),M.jsx("div",{className:"p-4 border-t border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800",children:M.jsxs("div",{className:"flex items-end space-x-2",children:[M.jsx("button",{onClick:()=>{var e;return null==(e=ee.current)?void 0:e.click()},className:"p-2 rounded-lg hover:bg-surface-hover dark:hover:bg-slate-700 transition-colors","aria-label":"Attach file",children:M.jsx(s,{className:"w-5 h-5 text-text-secondary dark:text-slate-400"})}),M.jsx("button",{onClick:()=>W?void(te.current&&W&&(te.current.stop(),te.current.stream.getTracks().forEach(e=>e.stop()),V(!1),se.current&&clearInterval(se.current))):(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);te.current=t,V(!0),_(0),se.current=window.setInterval(()=>{_(e=>e+1)},1e3),t.start(),t.ondataavailable=e=>{if(e.data.size>0){const t=URL.createObjectURL(e.data);de(t,U)}}}catch(e){}})(),className:"p-2 rounded-lg transition-colors "+(W?"bg-status-red text-white":"hover:bg-surface-hover dark:hover:bg-slate-700 text-text-secondary dark:text-slate-400"),"aria-label":W?"Stop recording":"Start voice message",children:W?M.jsx(p,{className:"w-5 h-5"}):M.jsx(g,{className:"w-5 h-5"})}),W&&M.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 bg-status-red text-white rounded-lg",children:[M.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),M.jsxs("span",{className:"text-sm",children:[Math.floor(U/60),":",(U%60).toString().padStart(2,"0")]})]}),M.jsxs("div",{className:"flex-1 relative",children:[M.jsx("input",{ref:Q,value:E,onChange:e=>B(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),me())},placeholder:"Type a message...",className:"w-full px-4 py-3 pr-12 rounded-xl border border-surface-border dark:border-slate-600 bg-surface-input dark:bg-slate-700 text-text-primary dark:text-slate-200 placeholder-text-tertiary dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-brand-primary"}),M.jsx("button",{onClick:()=>{},className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded hover:bg-surface-hover dark:hover:bg-slate-600 transition-colors",children:M.jsx(x,{className:"w-5 h-5 text-text-secondary dark:text-slate-400"})})]}),M.jsx("button",{onClick:me,disabled:!E.trim(),className:"p-2 rounded-lg bg-brand-primary text-white hover:bg-brand-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Send message",children:M.jsx(f,{className:"w-5 h-5"})})]})})]}):M.jsx("div",{className:"flex-1 flex items-center justify-center bg-surface-main dark:bg-slate-900",children:M.jsxs("div",{className:"text-center",children:[M.jsx(v,{className:"w-16 h-16 mx-auto mb-4 text-text-tertiary dark:text-slate-500"}),M.jsx("h3",{className:"text-xl font-semibold text-text-primary dark:text-slate-200 mb-2",children:"Welcome to Chat"}),M.jsx("p",{className:"text-text-secondary dark:text-slate-400",children:"Select a conversation to start messaging with enhanced features"})]})})}),M.jsx("input",{ref:ee,type:"file",multiple:!0,onChange:e=>e.target.files&&le(e.target.files),className:"hidden",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.txt"})]})};export{J as A,O as B,D,F as E,z as I,E as L,A as M,B as R,T,L as a,_ as b,$ as c,q as d,V as e,U as f,R as g,Q as h,W as i,M as j,H as r,P as t,K as u};
