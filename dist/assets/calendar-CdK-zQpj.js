import{D as e,T as t,L as r,R as s,a,t as n,b as o,j as l,c as d,d as i,e as c,f as u,r as m,M as h}from"./chat-Vz45qIYd.js";import{r as x}from"./ui-CcSG_NNb.js";const g=(l,d)=>{const i=l.map((e,t)=>({...e,instructorId:d[t%d.length].id}));let c=[];for(const s of e)for(const e of t)e!==r&&c.push({day:s,time:e});c=(e=>{const t=[...e];for(let r=t.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[t[r],t[e]]=[t[e],t[r]]}return t})(c);const u=[],m={},h={},x={};for(const e of i){let t=!1;for(const r of c){const l=e.instructorId,d=`${r.day}-${r.time}`,i=`${l}-${d}`,c=h[d]||0,g=`${e.id}-${r.day}`;if(!m[i]&&c<s&&!x[g]){m[i]=!0,h[d]=c+1,x[g]=!0;const s=c+1,p=new Date;for(let t=0;t<12;t++)for(let d=0;d<7;d++){const i=new Date(p.getFullYear(),p.getMonth(),p.getDate()+7*t+d);if(a[i.getDay()]===r.day){const t=n(i);u.push({id:`lesson-${e.id}-${t}-${r.time}`,studentId:e.id,instructorId:l,roomId:s,date:t,time:r.time,endTime:o(r.time,60),notes:"",status:"scheduled"});break}}t=!0;break}}}return{lessons:u,students:i}},p=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),b=({lessons:e,students:t,instructors:r,currentDate:s,onEditLesson:a,onAddLesson:o,onUpdateLessonPosition:i,onLessonDragStart:c})=>{const u=x.useMemo(()=>new Map(t.map(e=>[e.id,e])),[t]),m=x.useMemo(()=>new Map(r.map(e=>[e.id,e])),[r]),h=x.useMemo(()=>{const t=new Map;e.forEach(e=>{const r=e.date;t.has(r)||t.set(r,[]),t.get(r).push(e)});for(const e of t.values())e.sort((e,t)=>e.time.localeCompare(t.time));return t},[e]),g=x.useMemo(()=>{const e=s.getFullYear(),t=s.getMonth(),r=new Date(e,t,1).getDay(),a=new Date(e,t+1,0).getDate(),n=[],o=new Date(e,t,0).getDate();for(let s=0;s<r;s++){const a=o-r+s+1;n.push({date:new Date(e,t-1,a),isCurrentMonth:!1})}for(let s=1;s<=a;s++)n.push({date:new Date(e,t,s),isCurrentMonth:!0});const l=(7-n.length%7)%7;for(let s=1;s<=l;s++)n.push({date:new Date(e,t+1,s),isCurrentMonth:!1});return n},[s]),b=new Date,f=e=>{e.preventDefault(),e.dataTransfer.dropEffect=e.altKey?"copy":"move"};return l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("div",{className:"grid grid-cols-7 gap-px bg-surface-border dark:bg-slate-700 border border-surface-border dark:border-slate-700 rounded-md overflow-hidden min-w-[980px]",children:[d.map(e=>l.jsx("div",{className:"text-center font-medium text-text-secondary dark:text-slate-400 text-xs sm:text-sm py-2 bg-surface-header dark:bg-slate-800",children:e},e)),g.map(({date:e,isCurrentMonth:t},r)=>{const s=n(e),d=h.get(s)||[],x=e.toDateString()===b.toDateString(),g=[0,6].includes(e.getDay());return l.jsxs("div",{className:"relative p-1 sm:p-1.5 min-h-[90px] md:min-h-[120px] flex flex-col transition-colors "+(t?"bg-surface-card dark:bg-slate-800":"bg-surface-header/50 dark:bg-slate-900/50"),onDragOver:f,onDrop:t=>((e,t)=>{e.preventDefault();const r=e.dataTransfer.getData("lessonId");r&&i(r,t,void 0,e.altKey)})(t,e),onDragEnter:e=>e.currentTarget.classList.add("bg-brand-primary-light","dark:bg-brand-primary/20"),onDragLeave:e=>e.currentTarget.classList.remove("bg-brand-primary-light","dark:bg-brand-primary/20"),children:[g&&l.jsx("div",{className:"absolute inset-0 bg-surface-hover/30 dark:bg-slate-700/15 pointer-events-none rounded-sm"}),l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("span",{className:`text-xs font-semibold p-1.5 rounded-full flex items-center justify-center h-6 w-6 ${x?"bg-brand-primary text-text-on-color":""} ${t?"text-text-secondary dark:text-slate-400":"text-text-tertiary/70 dark:text-slate-600"}`,children:e.getDate()}),t&&l.jsx("button",{onClick:t=>{t.stopPropagation(),o(e)},className:"text-text-tertiary dark:text-slate-500 hover:text-brand-primary dark:hover:text-brand-primary transition-colors p-1 rounded-full hover:bg-surface-hover dark:hover:bg-slate-700","aria-label":`Add lesson on ${e.toLocaleDateString()}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})})]}),l.jsx("div",{className:"mt-1 space-y-1 overflow-y-auto flex-grow",children:t&&d.map(e=>{const t=u.get(e.studentId),r=m.get(e.instructorId),s=e.notes&&""!==e.notes.trim();return l.jsx("div",{className:"relative group",children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),a(e)},style:{backgroundColor:null==r?void 0:r.color},className:"w-full text-left p-1 md:p-1.5 rounded-md text-text-on-color dark:text-slate-800 text-[10px] md:text-[11px] leading-tight transition-all hover:opacity-80 dark:hover:opacity-90 active:cursor-grabbing cursor-grab",title:`Lesson: ${null==t?void 0:t.name} at ${e.time}${s?"\nHas note":""}\nDouble-click to edit.`,"aria-label":`Lesson for ${null==t?void 0:t.name} at ${e.time}${s?". This lesson has a note.":""}. Double click to edit.`,draggable:"true",onDragStart:t=>c(t,e),children:[l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("div",{className:"font-bold truncate",children:e.time}),s&&l.jsx(p,{})]}),l.jsx("div",{className:"truncate opacity-80",children:null==t?void 0:t.name})]})},e.id)})})]},r)})]})})},f=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),v=t[0],y=o(t[t.length-1],60),j=c(v),k=c(y),w=k-j,D=120;function N(e){const t=e.map(e=>({l:e,s:Math.max(j,c(e.time)),e:Math.min(k,c(e.endTime||o(e.time,60)))})).filter(e=>e.e>e.s).sort((e,t)=>e.s-t.s),r=[];let s=[],a=-1;const n=()=>{if(0===s.length)return;const e=[],t=[];for(let r=0;r<s.length;r++){const a=s[r];let n=0;for(;n<e.length&&!(a.s>=e[n]);n++);n===e.length?e.push(a.e):e[n]=a.e,t[r]=n}const n=e.length;for(let a=0;a<s.length;a++){const e=s[a];r.push({...e.l,_lane:t[a],_lanes:n,_top:2*(e.s-j),_height:2*(e.e-e.s)})}s=[],a=-1};for(const o of t)0===s.length||o.s<a?(s.push(o),a=Math.max(a,o.e)):(n(),s.push(o),a=o.e);return n(),r}const M=({lessons:e,students:s,instructors:a,currentDate:h,onEditLesson:g,onAddLesson:p,onUpdateLessonPosition:b,onLessonDragStart:v})=>{const[y,M]=x.useState(null),[$,S]=x.useState(new Date);x.useEffect(()=>{const e=setInterval(()=>S(new Date),6e4);return()=>clearInterval(e)},[]);const L=x.useMemo(()=>new Map(s.map(e=>[e.id,e])),[s]),I=x.useMemo(()=>new Map(a.map(e=>[e.id,e])),[a]),C=x.useMemo(()=>{const e=new Date(h);e.setDate(h.getDate()-h.getDay());const t=[];for(let r=0;r<7;r++){const s=new Date(e);s.setDate(e.getDate()+r),t.push(s)}return t},[h]),[_,T]=x.useState(()=>{const e=new Date,t=C.findIndex(t=>t.toDateString()===e.toDateString());return-1!==t?t:h.getDay()}),R=x.useMemo(()=>e.filter(e=>C.some(t=>n(t)===e.date)),[e,C]),z=x.useMemo(()=>{const e=new Map;for(const t of C){const r=n(t),s=R.filter(e=>e.date===r);e.set(r,N(s))}return e},[R,C]),H=new Date,B=(e,t)=>{e.preventDefault();const r=e.dataTransfer.getData("lessonId");if(!r)return;const s=e.currentTarget.getBoundingClientRect(),a=Math.min(Math.max(e.clientY-s.top,0),2*w),n=Math.round(a/2),o=u(j+n),l=m(o);b(r,t,l,e.altKey),M(null)},E=(e,t)=>{const r=e.currentTarget.getBoundingClientRect(),s=Math.min(Math.max(e.clientY-r.top,0),2*w),a=Math.round(s/2),n=u(j+a),o=m(n);p(t,o)},F=(t,r)=>{t.preventDefault(),t.dataTransfer.dropEffect=t.altKey?"copy":"move";const s=t.currentTarget.getBoundingClientRect(),a=Math.min(Math.max(t.clientY-s.top,0),2*w),l=Math.round(a/2),d=u(j+l),i=m(d),h=t.dataTransfer.getData("lessonId"),x=e.find(e=>e.id===h),g=x?c(x.endTime||o(x.time,60))-c(x.time):60,p=Math.max(20,2*g);let b=2*(c(i)-j);const f=2*w-p;b=Math.max(0,Math.min(b,f));const v=u(Math.min(k,c(i)+g));M({top:b,height:p,label:`${i}â€“${v}`,dateKey:n(r)})},P=()=>M(null),Y=C[_],A=z.get(n(Y))||[];return l.jsxs("div",{className:"border border-surface-border dark:border-slate-700 rounded-md overflow-hidden bg-surface-card dark:bg-slate-800",children:[l.jsxs("div",{className:"md:hidden",children:[l.jsx("div",{className:"border-b border-surface-border dark:border-slate-700",children:l.jsx("nav",{className:"-mb-px flex space-x-2 overflow-x-auto p-2","aria-label":"Tabs",children:C.map((e,t)=>l.jsxs("button",{onClick:()=>T(t),className:"whitespace-nowrap flex-shrink-0 p-2 border-b-2 font-medium text-sm rounded-t-md transition-colors "+(_===t?"border-brand-primary text-brand-primary":"border-transparent text-text-secondary dark:text-slate-400 hover:text-text-primary dark:hover:text-slate-200 hover:border-gray-300 dark:hover:border-slate-600"),children:[d[e.getDay()]," ",e.getDate()]},e.toISOString()))})}),l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsxs("div",{className:"relative",style:{height:2*w},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*D},children:i(e)},e)),(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=k&&Y.toDateString()===(new Date).toDateString()){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),l.jsxs("div",{className:"relative border-l border-surface-border dark:border-slate-700",style:{height:2*w},onDragOver:e=>F(e,Y),onDrop:e=>B(e,Y),onDragLeave:P,onDoubleClick:e=>E(e,Y),children:[(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=k&&Y.toDateString()===(new Date).toDateString()){const t=2*(e-j);return l.jsxs("div",{className:"absolute left-0 right-0 z-10",style:{top:t},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),y&&y.dateKey===n(Y)&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:y.top,height:y.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:y.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60",style:{top:t*D}},e)),(()=>{const e=c(r);if(e>=j&&e<k){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:D}})}return null})(),A.map(e=>{const t=L.get(e.studentId),r=I.get(e.instructorId),s=e.notes&&""!==e.notes.trim(),a=`calc((100% - ${2*(e._lanes-1)}px) / ${e._lanes})`,n=`calc(${e._lane} * (100% / ${e._lanes}) + ${2*e._lane}px)`,d=i(e.time),c=i(e.endTime||o(e.time,60)),u=Math.max(30,e._height),m=u<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:n,width:a,height:u},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},style:{backgroundColor:null==r?void 0:r.color,height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-[11px] leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${d}â€“${c}${s?"\nHas note":""}\nDouble-click to edit.`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${d} to ${c}${s?". This lesson has a note.":""} Double click to edit.`,draggable:"true",onDragStart:t=>v(t,e),children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),s&&l.jsx(f,{})]}),l.jsxs("div",{className:"text-[10px] opacity-90 truncate",children:["R",e.roomId," â€¢ ",d,"â€“",c]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:d}),s&&l.jsx(f,{})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)})]})]})]}),l.jsx("div",{className:"hidden md:block overflow-x-auto",children:l.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,minmax(180px,1fr))] min-w-[1100px]",children:[l.jsx("div",{className:"text-xs p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 sticky left-0 top-0 z-30 text-text-secondary dark:text-slate-400",children:"Time"}),C.map(e=>l.jsx("div",{className:"p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 sticky top-0 z-10 "+([0,6].includes(e.getDay())?"bg-surface-header dark:bg-slate-800":""),children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-xs sm:text-sm text-text-secondary dark:text-slate-400",children:d[e.getDay()]}),l.jsx("span",{className:"h-6 w-6 inline-flex items-center justify-center rounded-full text-xs font-semibold "+(e.toDateString()===H.toDateString()?"bg-brand-primary text-text-on-color":"text-text-secondary dark:text-slate-400"),children:e.getDate()})]})},e.toISOString())),l.jsxs("div",{className:"relative border-r border-surface-border dark:border-slate-700",style:{height:2*w},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*D},children:i(e)},e)),(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=k){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),C.map(e=>{const s=n(e),a=z.get(s)||[];return l.jsx("div",{className:"relative border-r border-surface-border dark:border-slate-700",style:{height:2*w},children:l.jsxs("div",{className:"absolute inset-0",onDragOver:t=>F(t,e),onDrop:t=>B(t,e),onDragLeave:P,onDoubleClick:t=>E(t,e),children:[[0,6].includes(e.getDay())&&l.jsx("div",{className:"absolute inset-0 bg-surface-hover/40 dark:bg-slate-700/20 pointer-events-none"}),(()=>{const t=60*$.getHours()+$.getMinutes();if(e.toDateString()===(new Date).toDateString()&&t>=j&&t<=k){const e=2*(t-j);return l.jsxs("div",{className:"absolute left-0 right-0 z-20",style:{top:e},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),y&&y.dateKey===s&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:y.top,height:y.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:y.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60 z-0",style:{top:t*D}},e)),t.map((t,r)=>l.jsx("button",{onClick:r=>{r.stopPropagation(),p(e,t)},className:"absolute right-1 z-10 p-1 rounded-full text-text-tertiary dark:text-slate-400 hover:text-brand-primary dark:hover:text-brand-primary hover:bg-surface-hover dark:hover:bg-slate-700 transition-colors",style:{top:r*D+6},title:`Add lesson at ${t}`,"aria-label":`Add lesson at ${t}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})},`add-${e.toISOString()}-${t}`)),(()=>{const e=c(r);if(e>=j&&e<k){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:D}})}return null})(),a.map(e=>{const t=L.get(e.studentId),r=I.get(e.instructorId),s=e.notes&&""!==e.notes.trim(),a=`calc((100% - ${2*(e._lanes-1)}px) / ${e._lanes})`,n=`calc(${e._lane} * (100% / ${e._lanes}) + ${2*e._lane}px)`,d=i(e.time),c=i(e.endTime||o(e.time,60)),u=Math.max(18,e._height),m=u<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:n,width:a,height:u},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},style:{backgroundColor:null==r?void 0:r.color,height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-[11px] leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${d}â€“${c}${s?"\nHas note":""}\nDouble-click to edit.`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${d} to ${c}${s?". This lesson has a note.":""} Double click to edit.`,draggable:"true",onDragStart:t=>v(t,e),children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),s&&l.jsx(f,{})]}),l.jsxs("div",{className:"text-[10px] opacity-90 truncate",children:["R",e.roomId," â€¢ ",d,"â€“",c]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:d}),s&&l.jsx(f,{})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)})]})},e.toISOString())})]})})]})},$=({lessons:e,students:s,instructors:d,currentDate:h,onEditLesson:g,onAddLesson:p,onUpdateLessonPosition:b,onLessonDragStart:f})=>{const[v,y]=x.useState(null),[j,k]=x.useState(new Date);x.useEffect(()=>{const e=setInterval(()=>k(new Date),6e4);return()=>clearInterval(e)},[]);const w=x.useMemo(()=>new Map(s.map(e=>[e.id,e])),[s]),D=x.useMemo(()=>new Map(d.map(e=>[e.id,e])),[d]),N=x.useMemo(()=>a[h.getDay()],[h]),M=x.useMemo(()=>e.filter(e=>e.date===n(h)),[e,h]),$=t[0],S=o(t[t.length-1],60),L=c($),I=c(S),C=I-L,_=120,T=x.useMemo(()=>{const e=M.map(e=>({l:e,s:Math.max(L,c(e.time)),e:Math.min(I,c(e.endTime||o(e.time,60)))})).filter(e=>e.e>e.s).sort((e,t)=>e.s-t.s),t=[];let r=[],s=-1;const a=()=>{if(0===r.length)return;const e=[],a=[];for(let t=0;t<r.length;t++){const s=r[t];let n=0;for(;n<e.length&&!(s.s>=e[n]);n++);n===e.length?e.push(s.e):e[n]=s.e,a[t]=n}const n=e.length;for(let s=0;s<r.length;s++){const e=r[s];t.push({...e.l,_lane:a[s],_lanes:n,_top:2*(e.s-L),_height:2*(e.e-e.s)})}r=[],s=-1};for(const n of e)0===r.length||n.s<s?(r.push(n),s=Math.max(s,n.e)):(a(),r.push(n),s=n.e);return a(),t},[M,L,I]),R=x.useRef(null),z=N;return l.jsxs("div",{className:"border border-surface-border dark:border-slate-700 rounded-md overflow-hidden bg-surface-card dark:bg-slate-800",children:[l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsx("div",{className:"p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 text-xs text-text-secondary dark:text-slate-400",children:"Time"}),l.jsx("div",{className:"p-2 text-center border-b border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-xs sm:text-sm text-text-secondary dark:text-slate-400",children:z}),l.jsx("span",{className:"h-6 w-6 inline-flex items-center justify-center rounded-full text-xs font-semibold "+((new Date).toDateString()===h.toDateString()?"bg-brand-primary text-text-on-color":"text-text-secondary dark:text-slate-400"),children:h.getDate()})]})})]}),l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsxs("div",{className:"relative",style:{height:2*C},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*_},children:i(e)},e)),(()=>{const e=60*j.getHours()+j.getMinutes();if(e>=L&&e<=I&&(new Date).toDateString()===h.toDateString()){const t=2*(e-L);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),l.jsxs("div",{className:"relative border-l border-surface-border dark:border-slate-700",style:{height:2*C},ref:R,onDragOver:e=>{var t;e.preventDefault(),e.dataTransfer.dropEffect=e.altKey?"copy":"move";const r=null==(t=R.current)?void 0:t.getBoundingClientRect();if(!r)return;const s=Math.min(Math.max(e.clientY-r.top,0),2*C),a=Math.round(s/2),n=u(L+a),l=m(n),d=e.dataTransfer.getData("lessonId"),h=M.find(e=>e.id===d),x=h?c(h.endTime||o(h.time,60))-c(h.time):60,g=Math.max(20,2*x);let p=2*(c(l)-L);const b=2*C-g;p=Math.max(0,Math.min(p,b));const f=u(Math.min(I,c(l)+x));y({top:p,height:g,label:`${i(l)}â€“${i(f)}`})},onDrop:e=>{var t;e.preventDefault();const r=e.dataTransfer.getData("lessonId"),s=null==(t=R.current)?void 0:t.getBoundingClientRect();if(!s)return;const a=Math.min(Math.max(e.clientY-s.top,0),2*C),n=Math.round(a/2),o=u(L+n),l=m(o);r&&b(r,h,l,e.altKey),y(null)},onDragLeave:()=>y(null),onDoubleClick:e=>{var t;const r=null==(t=R.current)?void 0:t.getBoundingClientRect();if(!r)return;const s=Math.min(Math.max(e.clientY-r.top,0),2*C),a=Math.round(s/2),n=u(L+a),o=m(n);p(h,o)},children:[(()=>{const e=60*j.getHours()+j.getMinutes();if(e>=L&&e<=I&&(new Date).toDateString()===h.toDateString()){const t=2*(e-L);return l.jsxs("div",{className:"absolute left-0 right-0 z-20",style:{top:t},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),v&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:v.top,height:v.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:v.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60",style:{top:t*_}},e)),t.map((e,t)=>l.jsx("button",{onClick:t=>{t.stopPropagation(),p(h,e)},className:"absolute right-1 z-20 p-1 rounded-full text-text-tertiary dark:text-slate-400 hover:text-brand-primary dark:hover:text-brand-primary hover:bg-surface-hover dark:hover:bg-slate-700 transition-colors",style:{top:t*_+6},title:`Add lesson at ${e}`,"aria-label":`Add lesson at ${e}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})},`add-${e}`)),(()=>{const e=c(r);if(e>=L&&e<I){const t=2*(e-L);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:_}})}return null})(),T.map(e=>{const t=w.get(e.studentId),r=D.get(e.instructorId),s=e.notes&&""!==e.notes.trim(),a=`calc((100% - ${2*(e._lanes-1)}px) / ${e._lanes})`,n=`calc(${e._lane} * (100% / ${e._lanes}) + ${2*e._lane}px)`,d=i(e.time),c=i(e.endTime||o(e.time,60)),u=Math.max(30,e._height),m=u<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:n,width:a,height:u},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},style:{backgroundColor:null==r?void 0:r.color,height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-[11px] leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${d}â€“${c}${s?"\nHas note":""}\nDouble-click to edit.`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${d} to ${c}${s?". This lesson has a note.":""} Double click to edit.`,draggable:"true",onDragStart:t=>f(t,e),children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),s&&l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})]}),l.jsxs("div",{className:"text-[10px] opacity-90 truncate",children:["R",e.roomId," â€¢ ",d,"â€“",c]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:d}),s&&l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)})]})]})]})},S=({year:e,month:t,isSelected:r,today:s,onSelect:a})=>{const n=new Date(e,t,1).getDay(),o=new Date(e,t+1,0).getDate(),i=[];for(let d=0;d<n;d++)i.push(l.jsx("div",{className:"text-center text-xs"},`pad-prev-${d}`));for(let d=1;d<=o;d++){const r=s.getDate()===d&&s.getMonth()===t&&s.getFullYear()===e;i.push(l.jsx("div",{className:"flex justify-center items-center",children:l.jsx("span",{className:"text-center text-xs w-5 h-5 flex items-center justify-center rounded-full "+(r?"bg-brand-primary text-text-on-color":""),children:d})},`day-${d}`))}return l.jsxs("div",{onClick:a,className:"p-2 border rounded-lg cursor-pointer transition-colors duration-200 "+(r?"border-brand-primary dark:border-brand-secondary bg-brand-primary-light dark:bg-brand-primary/20":"border-surface-border dark:border-slate-700 hover:bg-surface-hover dark:hover:bg-slate-700"),children:[l.jsx("h3",{className:"font-bold text-center mb-2 "+(r?"text-brand-primary":"text-text-primary dark:text-slate-200"),children:h[t]}),l.jsxs("div",{className:"grid grid-cols-7 gap-y-1 text-text-secondary dark:text-slate-400",children:[d.map(e=>l.jsx("div",{className:"text-center text-[10px] font-medium",children:e[0]},e)),i]})]})},L=({currentDate:e,onDateSelect:t})=>{const r=e.getFullYear(),s=e.getMonth(),a=new Date;return l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:h.map((e,n)=>l.jsx(S,{year:r,month:n,isSelected:n===s,today:a,onSelect:()=>t(new Date(r,n,1))},n))})};export{L as A,$ as D,b as M,M as W,g};
