import{D as e,T as t,L as r,R as a,a as s,t as o,b as n,j as l,c as d,d as i,e as c,f as u,r as m,M as h}from"./chat-CI5uTd2o.js";import{r as x}from"./ui-CcSG_NNb.js";const g=(l,d)=>{const i=l.map((e,t)=>({...e,instructorId:d[t%d.length].id}));let c=[];for(const a of e)for(const e of t)e!==r&&c.push({day:a,time:e});c=(e=>{const t=[...e];for(let r=t.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[t[r],t[e]]=[t[e],t[r]]}return t})(c);const u=[],m={},h={},x={};for(const e of i){let t=!1;for(const r of c){const l=e.instructorId,d=`${r.day}-${r.time}`,i=`${l}-${d}`,c=h[d]||0,g=`${e.id}-${r.day}`;if(!m[i]&&c<a&&!x[g]){m[i]=!0,h[d]=c+1,x[g]=!0;const a=c+1,b=new Date;for(let t=0;t<12;t++)for(let d=0;d<7;d++){const i=new Date(b.getFullYear(),b.getMonth(),b.getDate()+7*t+d);if(s[i.getDay()]===r.day){const t=o(i);u.push({id:`lesson-${e.id}-${t}-${r.time}`,studentId:e.id,instructorId:l,roomId:a,date:t,time:r.time,endTime:n(r.time,60),notes:"",status:"scheduled"});break}}t=!0;break}}}return{lessons:u,students:i}},b=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),p=({lessons:e,students:t,instructors:r,currentDate:a,onEditLesson:s,onAddLesson:n,onUpdateLessonPosition:i,onLessonDragStart:c})=>{const u=x.useMemo(()=>new Map(t.map(e=>[e.id,e])),[t]),m=x.useMemo(()=>new Map(r.map(e=>[e.id,e])),[r]),h=x.useMemo(()=>{const t=new Map;e.forEach(e=>{const r=e.date;t.has(r)||t.set(r,[]),t.get(r).push(e)});for(const e of t.values())e.sort((e,t)=>e.time.localeCompare(t.time));return t},[e]),g=x.useMemo(()=>{const e=a.getFullYear(),t=a.getMonth(),r=new Date(e,t,1).getDay(),s=new Date(e,t+1,0).getDate(),o=[],n=new Date(e,t,0).getDate();for(let a=0;a<r;a++){const s=n-r+a+1;o.push({date:new Date(e,t-1,s),isCurrentMonth:!1})}for(let a=1;a<=s;a++)o.push({date:new Date(e,t,a),isCurrentMonth:!0});const l=(7-o.length%7)%7;for(let a=1;a<=l;a++)o.push({date:new Date(e,t+1,a),isCurrentMonth:!1});return o},[a]),p=new Date,f=e=>{e.preventDefault(),e.dataTransfer.dropEffect=e.altKey?"copy":"move"};return l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("div",{className:"grid grid-cols-7 gap-px bg-surface-border dark:bg-slate-700 border border-surface-border dark:border-slate-700 rounded-md overflow-hidden min-w-[980px]",children:[d.map(e=>l.jsx("div",{className:"text-center font-medium text-text-secondary dark:text-slate-400 text-xs sm:text-sm py-2 bg-surface-header dark:bg-slate-800",children:e},e)),g.map(({date:e,isCurrentMonth:t},r)=>{const a=o(e),d=h.get(a)||[],x=e.toDateString()===p.toDateString(),g=[0,6].includes(e.getDay());return l.jsxs("div",{className:"relative p-1 sm:p-1.5 min-h-[90px] md:min-h-[120px] flex flex-col transition-colors "+(t?"bg-surface-card dark:bg-slate-800":"bg-surface-header/50 dark:bg-slate-900/50"),onDragOver:f,onDrop:t=>((e,t)=>{e.preventDefault();const r=e.dataTransfer.getData("lessonId");r&&i(r,t,void 0,e.altKey)})(t,e),onDragEnter:e=>e.currentTarget.classList.add("bg-brand-primary-light","dark:bg-brand-primary/20"),onDragLeave:e=>e.currentTarget.classList.remove("bg-brand-primary-light","dark:bg-brand-primary/20"),children:[g&&l.jsx("div",{className:"absolute inset-0 bg-surface-hover/30 dark:bg-slate-700/15 pointer-events-none rounded-sm"}),l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("span",{className:`text-xs font-semibold p-1.5 rounded-full flex items-center justify-center h-6 w-6 ${x?"bg-brand-primary text-text-on-color":""} ${t?"text-text-secondary dark:text-slate-400":"text-text-tertiary/70 dark:text-slate-600"}`,children:e.getDate()}),t&&l.jsx("button",{onClick:t=>{t.stopPropagation(),n(e)},className:"text-text-secondary dark:text-slate-300 hover:text-brand-primary dark:hover:text-brand-primary transition-colors p-1 rounded-full hover:bg-surface-hover dark:hover:bg-slate-700","aria-label":`Add lesson on ${e.toLocaleDateString()}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})})]}),l.jsx("div",{className:"mt-1 space-y-1 overflow-y-auto flex-grow",children:t&&d.map(e=>{const t=u.get(e.studentId),r=m.get(e.instructorId),a=e.notes&&""!==e.notes.trim();return l.jsx("div",{className:"relative group",children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),s(e)},style:{backgroundColor:(null==r?void 0:r.color)||"#6B7280"},className:"w-full text-left p-1 md:p-1.5 rounded-md text-text-on-color dark:text-slate-800 text-[10px] md:text-[11px] leading-tight transition-all hover:opacity-80 dark:hover:opacity-90 active:cursor-grabbing cursor-grab",title:`Lesson: ${null==t?void 0:t.name} at ${e.time}${a?"\nHas note":""}\nDouble-click to edit.`,"aria-label":`Lesson for ${null==t?void 0:t.name} at ${e.time}${a?". This lesson has a note.":""}. Double click to edit.`,draggable:"true",onDragStart:t=>c(t,e),children:[l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("div",{className:"font-bold truncate",children:e.time}),a&&l.jsx(b,{})]}),l.jsx("div",{className:"truncate opacity-80",children:null==t?void 0:t.name})]})},e.id)})})]},r)})]})})},f=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),v=t[0],y=n(t[t.length-1],60),j=c(v),w=c(y),k=w-j,D=120;function N(e){const t=e.map(e=>({l:e,s:Math.max(j,c(e.time)),e:Math.min(w,c(e.endTime||n(e.time,60)))})).filter(e=>e.e>e.s).sort((e,t)=>e.s-t.s),r=[];let a=[],s=-1;const o=()=>{if(0===a.length)return;const e=[],t=[];for(let r=0;r<a.length;r++){const s=a[r];let o=0;for(;o<e.length&&!(s.s>=e[o]);o++);o===e.length?e.push(s.e):e[o]=s.e,t[r]=o}const o=e.length;for(let s=0;s<a.length;s++){const e=a[s];r.push({...e.l,_lane:t[s],_lanes:o,_top:2*(e.s-j),_height:2*(e.e-e.s)})}a=[],s=-1};for(const n of t)0===a.length||n.s<s?(a.push(n),s=Math.max(s,n.e)):(o(),a.push(n),s=n.e);return o(),r}const M=({lessons:e,students:a,instructors:s,currentDate:h,onEditLesson:g,onAddLesson:b,onUpdateLessonPosition:p,onLessonDragStart:v})=>{const[y,M]=x.useState(null),[$,S]=x.useState(new Date);x.useEffect(()=>{const e=setInterval(()=>S(new Date),6e4);return()=>clearInterval(e)},[]);const _=x.useMemo(()=>new Map(a.map(e=>[e.id,e])),[a]),L=x.useMemo(()=>new Map(s.map(e=>[e.id,e])),[s]),T=x.useMemo(()=>{const e=new Date(h);e.setDate(h.getDate()-h.getDay());const t=[];for(let r=0;r<7;r++){const a=new Date(e);a.setDate(e.getDate()+r),t.push(a)}return t},[h]),[I,C]=x.useState(()=>{const e=new Date,t=T.findIndex(t=>t.toDateString()===e.toDateString());return-1!==t?t:h.getDay()}),z=x.useMemo(()=>e.filter(e=>T.some(t=>o(t)===e.date)),[e,T]),B=x.useMemo(()=>{const e=new Map;for(const t of T){const r=o(t),a=z.filter(e=>e.date===r);e.set(r,N(a))}return e},[z,T]),R=new Date,H=(e,t)=>{e.preventDefault();const r=e.dataTransfer.getData("lessonId");if(!r)return;const a=e.currentTarget.getBoundingClientRect(),s=Math.min(Math.max(e.clientY-a.top,0),2*k),o=Math.round(s/2),n=u(j+o),l=m(n);p(r,t,l,e.altKey),M(null)},E=(e,t)=>{const r=e.currentTarget.getBoundingClientRect(),a=Math.min(Math.max(e.clientY-r.top,0),2*k),s=Math.round(a/2),o=u(j+s),n=m(o);b(t,n)},A=(t,r)=>{t.preventDefault(),t.dataTransfer.dropEffect=t.altKey?"copy":"move";const a=t.currentTarget.getBoundingClientRect(),s=Math.min(Math.max(t.clientY-a.top,0),2*k),l=Math.round(s/2),d=u(j+l),i=m(d),h=t.dataTransfer.getData("lessonId"),x=e.find(e=>e.id===h),g=x?c(x.endTime||n(x.time,60))-c(x.time):60,b=Math.max(20,2*g);let p=2*(c(i)-j);const f=2*k-b;p=Math.max(0,Math.min(p,f));const v=u(Math.min(w,c(i)+g));M({top:p,height:b,label:`${i}â€“${v}`,dateKey:o(r)})},F=()=>M(null),P=T[I],W=B.get(o(P))||[];return l.jsxs("div",{className:"border border-surface-border dark:border-slate-700 rounded-md overflow-hidden bg-surface-card dark:bg-slate-800",children:[l.jsxs("div",{className:"md:hidden",children:[l.jsx("div",{className:"border-b border-surface-border dark:border-slate-700",children:l.jsx("nav",{className:"-mb-px flex space-x-2 overflow-x-auto p-2","aria-label":"Tabs",children:T.map((e,t)=>l.jsxs("button",{onClick:()=>C(t),className:"whitespace-nowrap flex-shrink-0 p-2 border-b-2 font-medium text-sm rounded-t-md transition-colors "+(I===t?"border-brand-primary text-brand-primary":"border-transparent text-text-secondary dark:text-slate-400 hover:text-text-primary dark:hover:text-slate-200 hover:border-gray-300 dark:hover:border-slate-600"),children:[d[e.getDay()]," ",e.getDate()]},e.toISOString()))})}),l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsxs("div",{className:"relative",style:{height:2*k},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*D},children:i(e)},e)),(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=w&&P.toDateString()===(new Date).toDateString()){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),l.jsx("div",{className:"relative border-l border-surface-border dark:border-slate-700 "+(Math.max(...W.map(e=>e._lanes),1)>4?"overflow-x-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-slate-400 dark:scrollbar-thumb-slate-600":""),style:{height:2*k},onDragOver:e=>A(e,P),onDrop:e=>H(e,P),onDragLeave:F,onDoubleClick:e=>E(e,P),children:l.jsxs("div",{className:"relative h-full",style:{minWidth:"100%",width:(()=>{const e=Math.max(...W.map(e=>e._lanes),1);if(e>4){return`${e*120+(e-1)*2+40}px`}return"100%"})()},children:[(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=w&&P.toDateString()===(new Date).toDateString()){const t=2*(e-j);return l.jsxs("div",{className:"absolute left-0 right-0 z-10",style:{top:t},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),y&&y.dateKey===o(P)&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:y.top,height:y.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:y.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60",style:{top:t*D}},e)),(()=>{const e=c(r);if(e>=j&&e<w){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:D}})}return null})(),(()=>{const e=Math.max(...W.map(e=>e._lanes),1);return e>4?l.jsxs("div",{className:"absolute top-2 right-2 bg-black/20 text-white text-[10px] px-2 py-1 rounded-full z-30 pointer-events-none",children:[e," lessons â†’ scroll"]}):null})(),W.map(e=>{const t=_.get(e.studentId),r=L.get(e.instructorId),a=e.notes&&""!==e.notes.trim();let s,o;if(e._lanes>4)s="120px",o=122*e._lane+"px";else{const t="(100% - 40px)";s=`calc((${t} - ${2*(e._lanes-1)}px) / ${e._lanes})`,o=`calc(${e._lane} * (${t} / ${e._lanes}) + ${2*e._lane}px)`}const d=i(e.time),c=i(e.endTime||n(e.time,60)),u=Math.max(30,e._height),m=u<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:o,width:s,height:u},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},onMouseDown:e=>{1===e.detail&&e.currentTarget.setAttribute("data-allow-drag","true")},style:{backgroundColor:(null==r?void 0:r.color)||"#6B7280",height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-sm leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${d}â€“${c}${a?"\nHas note":""}\nDrag to move â€¢ Double-click to edit`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${d} to ${c}${a?". This lesson has a note.":""} Drag to move or double click to edit.`,draggable:"true",onDragStart:t=>{t.currentTarget.style.opacity="0.5",v(t,e)},onDragEnd:e=>{e.currentTarget.style.opacity="1"},children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),a&&l.jsx(f,{})]}),l.jsxs("div",{className:"text-xs opacity-90 truncate",children:["R",e.roomId," â€¢ ",d,"â€“",c]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:d}),a&&l.jsx(f,{})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)})]})})]})]}),l.jsx("div",{className:"hidden md:block overflow-x-auto",children:l.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,minmax(180px,1fr))] min-w-[1100px]",children:[l.jsx("div",{className:"text-xs p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 sticky left-0 top-0 z-30 text-text-secondary dark:text-slate-400",children:"Time"}),T.map(e=>l.jsx("div",{className:"p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 sticky top-0 z-10 "+([0,6].includes(e.getDay())?"bg-surface-header dark:bg-slate-800":""),children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-xs sm:text-sm text-text-secondary dark:text-slate-400",children:d[e.getDay()]}),l.jsx("span",{className:"h-6 w-6 inline-flex items-center justify-center rounded-full text-xs font-semibold "+(e.toDateString()===R.toDateString()?"bg-brand-primary text-text-on-color":"text-text-secondary dark:text-slate-400"),children:e.getDate()})]})},e.toISOString())),l.jsxs("div",{className:"relative border-r border-surface-border dark:border-slate-700",style:{height:2*k},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*D},children:i(e)},e)),(()=>{const e=60*$.getHours()+$.getMinutes();if(e>=j&&e<=w){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),T.map(e=>{const a=o(e),s=B.get(a)||[];return l.jsx("div",{className:"relative border-r border-surface-border dark:border-slate-700 "+(Math.max(...s.map(e=>e._lanes),1)>4?"overflow-x-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-slate-400 dark:scrollbar-thumb-slate-600":""),style:{height:2*k},children:l.jsxs("div",{className:"relative h-full",style:{minWidth:"100%",width:(()=>{const e=Math.max(...s.map(e=>e._lanes),1);if(e>4){return`${e*120+(e-1)*2+40}px`}return"100%"})()},onDragOver:t=>A(t,e),onDrop:t=>H(t,e),onDragLeave:F,onDoubleClick:t=>E(t,e),children:[[0,6].includes(e.getDay())&&l.jsx("div",{className:"absolute inset-0 bg-surface-hover/40 dark:bg-slate-700/20 pointer-events-none"}),(()=>{const t=60*$.getHours()+$.getMinutes();if(e.toDateString()===(new Date).toDateString()&&t>=j&&t<=w){const e=2*(t-j);return l.jsxs("div",{className:"absolute left-0 right-0 z-20",style:{top:e},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),y&&y.dateKey===a&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:y.top,height:y.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:y.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60 z-0",style:{top:t*D}},e)),t.flatMap((e,t)=>[1,2,3].map(r=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/15 dark:border-slate-700/15 z-0",style:{top:t*D+30*r}},`${e}-${r}`))),l.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-10 bg-surface-card/30 dark:bg-slate-800/30 border-l border-surface-border/30 dark:border-slate-700/30",children:t.map((t,r)=>l.jsx("button",{onClick:r=>{r.stopPropagation(),b(e,t)},className:"absolute left-1/2 transform -translate-x-1/2 z-10 p-1 rounded-full text-text-secondary dark:text-slate-300 hover:text-brand-primary dark:hover:text-brand-primary hover:bg-surface-hover dark:hover:bg-slate-700 transition-colors",style:{top:r*D+6},title:`Add lesson at ${t}`,"aria-label":`Add lesson at ${t}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})},`add-${e.toISOString()}-${t}`))}),(()=>{const e=c(r);if(e>=j&&e<w){const t=2*(e-j);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:D}})}return null})(),s.map(e=>{const t=_.get(e.studentId),r=L.get(e.instructorId),a=e.notes&&""!==e.notes.trim();let s,o;if(e._lanes>4)s="120px",o=122*e._lane+"px";else{const t="(100% - 40px)";s=`calc((${t} - ${2*(e._lanes-1)}px) / ${e._lanes})`,o=`calc(${e._lane} * (${t} / ${e._lanes}) + ${2*e._lane}px)`}const d=i(e.time),c=i(e.endTime||n(e.time,60)),u=Math.max(18,e._height),m=u<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:o,width:s,height:u},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},onMouseDown:e=>{1===e.detail&&e.currentTarget.setAttribute("data-allow-drag","true")},style:{backgroundColor:(null==r?void 0:r.color)||"#6B7280",height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-sm leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${d}â€“${c}${a?"\nHas note":""}\nDrag to move â€¢ Double-click to edit`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${d} to ${c}${a?". This lesson has a note.":""} Drag to move or double click to edit.`,draggable:"true",onDragStart:t=>{t.currentTarget.style.opacity="0.5",v(t,e)},onDragEnd:e=>{e.currentTarget.style.opacity="1"},children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),a&&l.jsx(f,{})]}),l.jsxs("div",{className:"text-xs opacity-90 truncate",children:["R",e.roomId," â€¢ ",d,"â€“",c]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:d}),a&&l.jsx(f,{})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)}),(()=>{const e=Math.max(...s.map(e=>e._lanes),1);return e>4?l.jsxs("div",{className:"absolute top-2 right-2 bg-black/20 text-white text-[10px] px-2 py-1 rounded-full z-30 pointer-events-none",children:[e," lessons â†’ scroll"]}):null})()]})},e.toISOString())})]})})]})},$=({lessons:e,students:a,instructors:d,currentDate:h,onEditLesson:g,onAddLesson:b,onUpdateLessonPosition:p,onLessonDragStart:f})=>{const[v,y]=x.useState(null),[j,w]=x.useState(new Date);x.useEffect(()=>{const e=setInterval(()=>w(new Date),6e4);return()=>clearInterval(e)},[]);const k=x.useMemo(()=>new Map(a.map(e=>[e.id,e])),[a]),D=x.useMemo(()=>new Map(d.map(e=>[e.id,e])),[d]),N=x.useMemo(()=>s[h.getDay()],[h]),M=x.useMemo(()=>e.filter(e=>e.date===o(h)),[e,h]),$=t[0],S=n(t[t.length-1],60),_=c($),L=c(S),T=L-_,I=120,C=x.useMemo(()=>{const e=M.map(e=>({l:e,s:Math.max(_,c(e.time)),e:Math.min(L,c(e.endTime||n(e.time,60)))})).filter(e=>e.e>e.s).sort((e,t)=>e.s-t.s),t=[];let r=[],a=-1;const s=()=>{if(0===r.length)return;const e=[],s=[];for(let t=0;t<r.length;t++){const a=r[t];let o=0;for(;o<e.length&&!(a.s>=e[o]);o++);o===e.length?e.push(a.e):e[o]=a.e,s[t]=o}const o=e.length;for(let a=0;a<r.length;a++){const e=r[a];t.push({...e.l,_lane:s[a],_lanes:o,_top:2*(e.s-_),_height:2*(e.e-e.s)})}r=[],a=-1};for(const o of e)0===r.length||o.s<a?(r.push(o),a=Math.max(a,o.e)):(s(),r.push(o),a=o.e);return s(),t},[M,_,L]),z=x.useRef(null),B=N;return l.jsxs("div",{className:"border border-surface-border dark:border-slate-700 rounded-md overflow-hidden bg-surface-card dark:bg-slate-800",children:[l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsx("div",{className:"p-2 text-center border-b border-r border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800 text-xs text-text-secondary dark:text-slate-400",children:"Time"}),l.jsx("div",{className:"p-2 text-center border-b border-surface-border dark:border-slate-700 bg-surface-header dark:bg-slate-800",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-xs sm:text-sm text-text-secondary dark:text-slate-400",children:B}),l.jsx("span",{className:"h-6 w-6 inline-flex items-center justify-center rounded-full text-xs font-semibold "+((new Date).toDateString()===h.toDateString()?"bg-brand-primary text-text-on-color":"text-text-secondary dark:text-slate-400"),children:h.getDate()})]})})]}),l.jsxs("div",{className:"grid grid-cols-[64px_1fr]",children:[l.jsxs("div",{className:"relative",style:{height:2*T},children:[t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 px-2 text-right text-xs text-text-secondary dark:text-slate-400",style:{top:t*I},children:i(e)},e)),(()=>{const e=60*j.getHours()+j.getMinutes();if(e>=_&&e<=L&&(new Date).toDateString()===h.toDateString()){const t=2*(e-_);return l.jsx("div",{className:"absolute left-0 right-0",style:{top:t},children:l.jsx("div",{className:"h-px bg-brand-primary/70"})})}return null})()]}),l.jsxs("div",{className:"relative border-l border-surface-border dark:border-slate-700",style:{height:2*T},ref:z,onDragOver:e=>{var t;e.preventDefault(),e.dataTransfer.dropEffect=e.altKey?"copy":"move";const r=null==(t=z.current)?void 0:t.getBoundingClientRect();if(!r)return;const a=Math.min(Math.max(e.clientY-r.top,0),2*T),s=Math.round(a/2),o=u(_+s),l=m(o),d=e.dataTransfer.getData("lessonId"),h=M.find(e=>e.id===d),x=h?c(h.endTime||n(h.time,60))-c(h.time):60,g=Math.max(20,2*x);let b=2*(c(l)-_);const p=2*T-g;b=Math.max(0,Math.min(b,p));const f=u(Math.min(L,c(l)+x));y({top:b,height:g,label:`${i(l)}â€“${i(f)}`})},onDrop:e=>{var t;e.preventDefault();const r=e.dataTransfer.getData("lessonId"),a=null==(t=z.current)?void 0:t.getBoundingClientRect();if(!a)return;const s=Math.min(Math.max(e.clientY-a.top,0),2*T),o=Math.round(s/2),n=u(_+o),l=m(n);r&&p(r,h,l,e.altKey),y(null)},onDragLeave:()=>y(null),onDoubleClick:e=>{var t;const r=null==(t=z.current)?void 0:t.getBoundingClientRect();if(!r)return;const a=Math.min(Math.max(e.clientY-r.top,0),2*T),s=Math.round(a/2),o=u(_+s),n=m(o);b(h,n)},children:[(()=>{const e=60*j.getHours()+j.getMinutes();if(e>=_&&e<=L&&(new Date).toDateString()===h.toDateString()){const t=2*(e-_);return l.jsxs("div",{className:"absolute left-0 right-0 z-20",style:{top:t},children:[l.jsx("div",{className:"h-px bg-brand-primary"}),l.jsx("div",{className:"absolute -left-1 -top-1 h-2 w-2 rounded-full bg-brand-primary"})]})}return null})(),v&&l.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:v.top,height:v.height},children:[l.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-brand-primary/70 bg-brand-primary/10 rounded-sm"}),l.jsx("div",{className:"absolute -left-1 -top-5 bg-brand-primary text-text-on-color text-[10px] px-1 py-0.5 rounded shadow-sm",children:v.label})]}),t.map((e,t)=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/60 dark:border-slate-700/60",style:{top:t*I}},e)),t.flatMap((e,t)=>[1,2,3].map(r=>l.jsx("div",{className:"absolute left-0 right-0 border-t border-surface-border/20 dark:border-slate-700/20",style:{top:t*I+30*r}},`${e}-${r}`))),l.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-14 bg-surface-card/30 dark:bg-slate-800/30 border-l border-surface-border/30 dark:border-slate-700/30",children:t.map((e,t)=>{const r=C.some(e=>{const r=e._top,a=r+e._height,s=t*I;return r<s+I&&a>s});return l.jsx("button",{onClick:t=>{t.stopPropagation(),b(h,e)},className:"absolute left-1/2 transform -translate-x-1/2 z-30 p-1.5 rounded-full text-text-secondary dark:text-slate-300 hover:text-brand-primary dark:hover:text-brand-primary hover:bg-surface-hover dark:hover:bg-slate-700 transition-colors shadow-sm "+(r?"bg-surface-card dark:bg-slate-800 border border-surface-border dark:border-slate-600":"hover:shadow-md"),style:{top:t*I+4},title:`Add lesson at ${i(e)}`,"aria-label":`Add lesson at ${i(e)}`,children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12M6 12h12"})})},`add-${e}`)})}),(()=>{const e=c(r);if(e>=_&&e<L){const t=2*(e-_);return l.jsx("div",{className:"absolute left-0 right-0 bg-surface-input/50 dark:bg-slate-700/50",style:{top:t,height:I}})}return null})(),C.map(e=>{const t=k.get(e.studentId),r=D.get(e.instructorId),a=e.notes&&""!==e.notes.trim(),s=`calc((calc(100% - 56px - 8px) - ${2*(e._lanes-1)}px) / ${e._lanes})`,o=s,d=`calc(${e._lane} * (${s}) + ${2*e._lane}px + 4px)`,c=i(e.time),u=i(e.endTime||n(e.time,60)),m=Math.max(30,e._height),h=m<42;return l.jsx("div",{className:"absolute p-1 z-20",style:{top:e._top,left:d,width:o,height:m},children:l.jsxs("button",{onDoubleClick:t=>{t.stopPropagation(),g(e)},onMouseDown:e=>{1===e.detail&&e.currentTarget.setAttribute("data-allow-drag","true")},style:{backgroundColor:(null==r?void 0:r.color)||"#6B7280",height:"100%"},className:"relative w-full h-full text-left pl-3 pr-2 py-1 rounded text-text-on-color dark:text-slate-800 text-sm leading-tight transition-all hover:opacity-90 active:cursor-grabbing cursor-grab shadow-md overflow-hidden",title:`Lesson: ${null==t?void 0:t.name} with ${null==r?void 0:r.name} â€¢ R${e.roomId}\n${c}â€“${u}${a?"\nHas note":""}\nDrag to move â€¢ Double-click to edit`,"aria-label":`Lesson for ${null==t?void 0:t.name} with ${null==r?void 0:r.name} in Room ${e.roomId} from ${c} to ${u}${a?". This lesson has a note.":""} Drag to move or double click to edit.`,draggable:"true",onDragStart:t=>{t.currentTarget.style.opacity="0.5",f(t,e)},onDragEnd:e=>{e.currentTarget.style.opacity="1"},children:[l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 opacity-80",style:{background:"repeating-linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.35) 2px, transparent 2px, transparent 4px)"}}),h?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold truncate mr-2",children:null==t?void 0:t.name}),a&&l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})]}),l.jsxs("div",{className:"text-xs opacity-90 truncate",children:["R",e.roomId," â€¢ ",c,"â€“",u]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsx("span",{className:"font-semibold mr-2",children:c}),a&&l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})]}),l.jsx("div",{className:"truncate",children:null==t?void 0:t.name})]})]})},e.id)})]})]})]})},S=({year:e,month:t,isSelected:r,today:a,onSelect:s})=>{const o=new Date(e,t,1).getDay(),n=new Date(e,t+1,0).getDate(),i=[];for(let d=0;d<o;d++)i.push(l.jsx("div",{className:"text-center text-xs"},`pad-prev-${d}`));for(let d=1;d<=n;d++){const r=a.getDate()===d&&a.getMonth()===t&&a.getFullYear()===e;i.push(l.jsx("div",{className:"flex justify-center items-center",children:l.jsx("span",{className:"text-center text-xs w-5 h-5 flex items-center justify-center rounded-full "+(r?"bg-brand-primary text-text-on-color":""),children:d})},`day-${d}`))}return l.jsxs("div",{onClick:s,className:"p-2 border rounded-lg cursor-pointer transition-colors duration-200 "+(r?"border-brand-primary dark:border-brand-secondary bg-brand-primary-light dark:bg-brand-primary/20":"border-surface-border dark:border-slate-700 hover:bg-surface-hover dark:hover:bg-slate-700"),children:[l.jsx("h3",{className:"font-bold text-center mb-2 "+(r?"text-brand-primary":"text-text-primary dark:text-slate-200"),children:h[t]}),l.jsxs("div",{className:"grid grid-cols-7 gap-y-1 text-text-secondary dark:text-slate-400",children:[d.map(e=>l.jsx("div",{className:"text-center text-[10px] font-medium",children:e[0]},e)),i]})]})},_=({currentDate:e,onDateSelect:t})=>{const r=e.getFullYear(),a=e.getMonth(),s=new Date;return l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:h.map((e,o)=>l.jsx(S,{year:r,month:o,isSelected:o===a,today:s,onSelect:()=>t(new Date(r,o,1))},o))})};export{_ as A,$ as D,p as M,M as W,g};
